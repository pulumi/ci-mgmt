# WARNING: This file is autogenerated - changes will be overwritten when regenerated by https://github.com/pulumi/ci-mgmt

name: "Prerequisites"

on:
  workflow_call:
    inputs:
      is_pr:
        type: boolean
        required: true
      is_automated:
        type: boolean
        required: true
      default_branch:
        type: string
        required: true
    outputs:
      version:
        description: "Provider version being built"
        value: ${{ jobs.prerequisites.outputs.version }}

env:
#{{ .Config.Env | toYaml | indent 2 }}#

jobs:
  prerequisites:
    name: prerequisites
    runs-on: #{{ .Config.Runner.Prerequisites }}#
    permissions:
      contents: read
      pull-requests: write
    outputs:
      version: ${{ steps.provider-version.outputs.version }}
    steps:
    - name: Checkout Repo
      uses: #{{ .Config.ActionVersions.Checkout }}#
      with:
        #{{- if .Config.CheckoutSubmodules }}#
        submodules: #{{ .Config.CheckoutSubmodules }}#
        #{{- end }}#
        persist-credentials: false
    - uses: #{{ .Config.ActionVersions.ProviderVersionAction }}#
      id: provider-version
      with:
        major-version: #{{ .Config.MajorVersion }}#
        set-env: 'PROVIDER_VERSION'
    #{{- if not .Config.NoSchema }}#
    - name: Generate schema-embed
      run: make schema_embed
    - name: Build tfgen
      run: make tfgen_build_only
    - name: Upload artifacts
      uses: ./.github/actions/upload-prerequisites
    #{{- end }}#
