# WARNING: This file is autogenerated - changes will be overwritten if not made via https://github.com/pulumi/ci-mgmt

env:
  GH_TOKEN: ${{ secrets.PULUMI_BOT_TOKEN }}
  GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
jobs:
  upgrade_provider:
    if: ${{ contains(github.event.issue.title, 'Upgrade terraform-provider-') || github.event_name == 'workflow_dispatch' }}
    name: upgrade-provider
    runs-on: #{{ .Config.runner.default }}#
    steps:
    - name: Call upgrade provider action
      uses: #{{ .Config.actionVersions.upgradeProviderAction }}#
      with:
        kind: all
    - env:
        SLACK_CHANNEL: provider-upgrade-publish-status
        SLACK_COLOR: "#7CFC00"
        SLACK_ICON_EMOJI: ":taco:"
        SLACK_MESSAGE: >-
          Upgrade succeeded :heart_decoration:

          PR opened at github.com/pulumi/${{ github.event.repository.name }}/pulls
        SLACK_TITLE: ${{ github.event.repository.name }} upgrade result
        SLACK_USERNAME: provider-bot
        SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
      name: Send Upgrade Success To Slack
      uses: #{{ .Config.actionVersions.slackNotification }}#
    - env:
        SLACK_CHANNEL: provider-upgrade-publish-status
        SLACK_COLOR: "#FF0000"
        SLACK_ICON_EMOJI: ":taco:"
        SLACK_MESSAGE: " Upgrade failed :x:"
        SLACK_TITLE: ${{ github.event.repository.name }} upgrade result
        SLACK_USERNAME: provider-bot
        SLACK_WEBHOOK: ${{ secrets.SLACK_WEBHOOK_URL }}
      if: failure()
      name: Send Upgrade Failure To Slack
      uses: #{{ .Config.actionVersions.slackNotification }}#
name: Upgrade provider
on:
  issues:
    types:
    - opened
  workflow_dispatch: {}
