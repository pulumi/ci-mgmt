name: "Verify Release"

on:
  workflow_dispatch:
    inputs:
      providerVersion:
        description: "The version of the provider to verify"
        required: true
        type: string
  workflow_call:
    inputs:
      providerVersion:
        type: string
        required: true

jobs:
  verify-release:
    name: verify-release
    strategy:
      matrix:
        runner:
          - ubuntu-latest
          - macos-latest
          - windows-latest
    runs-on: ${{ matrix.runner }}
    steps:
      - name: Checkout Repo
        uses: actions/checkout@v4
#{{- if .Config.releaseVerification }}#
      - name: Setup tools
        uses: ./.github/actions/setup-tools
      - id: version
        uses: pulumi/provider-version-action@v1
        with:
          set-env: 'PROVIDER_VERSION'
#{{- if .Config.releaseVerification.nodejs }}#
      - name: Verify nodejs release
        uses: pulumi/verify-provider-release@v1
        with:
          runtime: nodejs
          directory: #{{ .Config.releaseVerification.nodejs }}#
          provider: #{{ .Config.provider }}#
          providerVersion: ${{ inputs.version }}
#{{ end }}#
#{{- if .Config.releaseVerification.python }}#
      - name: Verify python release
        uses: pulumi/verify-provider-release@v1
        with:
          runtime: python
          directory: #{{ .Config.releaseVerification.python }}#
          provider: #{{ .Config.provider }}#
          providerVersion: ${{ inputs.version }}
#{{ end }}#
#{{- if .Config.releaseVerification.dotnet }}#
      - name: Verify dotnet release
        uses: pulumi/verify-provider-release@v1
        with:
          runtime: dotnet
          directory: #{{ .Config.releaseVerification.dotnet }}#
          provider: #{{ .Config.provider }}#
          providerVersion: ${{ inputs.version }}
#{{ end }}#
#{{- if .Config.releaseVerification.go }}#
      - name: Verify go release
        uses: pulumi/verify-provider-release@v1
        with:
          runtime: go
          directory: #{{ .Config.releaseVerification.go }}#
          provider: #{{ .Config.provider }}#
          providerVersion: ${{ inputs.version }}
#{{ end }}#
#{{ end }}#